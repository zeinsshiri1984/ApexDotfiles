GITHUB_TOKEN := `gh auth token 2>/dev/null || echo ""`

user:
    @just --list

brew:
    @echo "升级brew及同步远程仓库元数据"
    brew update
    @echo "同步Brewfile"
    brew bundle --file=~/.config/homebrew/Brewfile --cleanup --force
    @echo "升级所有已安装工具到最新版本"
    brew upgrade
    @echo "移除孤儿依赖"
    brew autoremove
    @echo "清理旧版本下载缓存和锁定的二进制文件"
    brew cleanup

gh:
    # 交互式登录 (支持重复执行以刷新权限)
    gh auth login -w -p https -s repo,workflow,gist,read:packages
    
    @just gh-tips
    
mise:
    @echo "mise 自动识别 GITHUB_TOKEN 环境变量解决 GitHub API 速率限制"
    # [安装] 根据 config.toml 安装新增的工具
    @GITHUB_TOKEN={{GITHUB_TOKEN}} mise install --yes
    
    # [升级] 将已安装的工具升级至 config.toml 允许的最新版本
    @GITHUB_TOKEN={{GITHUB_TOKEN}} mise upgrade --yes
    
    # [清理] 卸载 config.toml 中已删除的工具及孤儿版本
    @GITHUB_TOKEN={{GITHUB_TOKEN}} mise prune --yes
    
    # 刷新垫片 (shims) 确保环境变量一致
    mise reshim

    @just mise-tips

    @mise cache clear

gh-tips:
    @echo " [身份/权限]"
    @echo "  gh auth status          # 查看当前登录状态及权限范围"
    @echo "  gh auth token           # 打印当前 Token (常用于脚本注入)"
    @echo "  gh auth refresh         # 刷新或扩充权限范围"
    @echo "  gh auth switch          # 切换账号"
    @echo " [仓库操作]"
    @echo "  gh repo clone <name>    # 快速克隆 (支持缩写如 'user/repo')"
    @echo "  gh repo create          # 交互式创建新仓库"
    @echo "  gh repo view --web      # 在浏览器中直接打开当前项目页面"
    @echo " [PR/Issue 管理]"
    @echo "  gh pr list / status     # 查看当前 PR 列表或状态"
    @echo "  gh pr create --web      # 在网页端发起 PR (最推荐用法)"
    @echo "  gh pr checkout <num>    # 快速检出某个 PR 的分支到本地"
    @echo " [其他]"
    @echo "  gh run list / watch     # 查看 GitHub Actions 运行状态"
    
mise-tips:
    @echo " [工具查询]"
    @echo "  mise ls                 # 列出当前所有已安装工具及版本"
    @echo "  mise ls-remote <tool>   # 列出工具支持的所有版本"
    @echo "  mise current            # 显示当前目录下生效的工具版本"
    @echo "  mise which <bin>        # 查找某个工具的实际二进制路径"
    @echo " [版本管理]"
    @echo "  mise use <tool>@latest  # 安装并切换工具 (自动写入 config.toml)"
    @echo "  mise uninstall <tool>   # 卸载特定工具"
    @echo " [运行时]"
    @echo "  mise exec -- <cmd>      # 在当前工具环境下执行命令"
    @echo "  mise env                # 打印当前环境变量 (诊断用)"
    @echo " [维护]"
    @echo "  mise doctor             # 诊断配置、插件及路径问题"
    @echo "  mise tasks ls           # 查看 mise 定义的本地任务"

yazi:
    @if ! grep -q "tokyo-night" "$HOME/.config/yazi/package.toml" 2>/dev/null; then \
        ya add yazi-rs/themes:tokyo-night; \
    fi
    ya upgrade

helix:
    @hx --grammar fetch
    @hx --grammar build
    @hx --health

chezmoi-tips:
    echo "- 同步远程最新更改(包含apply): chezmoi update -v"
    echo "- 手动重新应用配置: chezmoi apply"
    echo "- 查看本地差异:     chezmoi diff"
    echo "- 进入源码目录:     chezmoi cd"

gtrash-tips:
    @echo "放入垃圾桶:       gtrash put <文件/目录>"
    @echo "交互式恢复:       gtrash restore (支持多选和搜索，推荐用法)"
    @echo "浏览垃圾桶:       gtrash find"
    @echo "查看垃圾桶占用空间: gtrash summary"
    @echo "清理30天前记录:    gtrash prune --days 30"
    @echo "物理删除所有:      gtrash prune --all"

zellij-tips:
    @echo ">>> 全局核心快捷键 (以 config.kdl 为准)"
    @echo "Ctrl+a            : 从 Locked 切换到 Normal"
    @echo "Ctrl+q            : Detach 当前会话"
    @echo "Esc               : 回到 Locked 模式"
    @echo ""
    @echo ">>> Pane 管理"
    @echo "Alt+n             : 新建 Pane (stacked 自动)"
    @echo "Alt+r             : 向右分屏"
    @echo "Alt+d             : 向下分屏"
    @echo "Alt+x             : 关闭当前 Pane"
    @echo "Alt+f             : 当前 Pane 全屏切换"
    @echo "Alt+e             : 平铺 / 浮动 切换"
    @echo ""
    @echo ">>> Pane 导航 (Vim 风格)"
    @echo "Alt+h/j/k/l       : 左/下/上/右 移动焦点"
    @echo "Alt+方向键        : 同上"
    @echo ""
    @echo ">>> Pane 大小"
    @echo "Alt+=             : 增大"
    @echo "Alt+-             : 减小"
    @echo ""
    @echo ">>> 浮动工具 (floating + close_on_exit)"
    @echo "Alt+y             : yz"
    @echo "Alt+g             : lazygit"
    @echo "Alt+p             : podman-tui"
    @echo "Alt+b             : btop"
    @echo ""
    @echo ">>> Tab 管理"
    @echo "Alt+t             : 新建 Worktree Tab (zj-worktree)"
    @echo "Alt+[ / Alt+]     : 上一个 / 下一个 Tab"
    @echo "Alt+1..9          : 跳转到指定 Tab"
    @echo "Alt+x             : 关闭当前 Pane (非关闭 Tab)"
    @echo "Alt+R             : 重命名 Tab"
    @echo "Alt+s             : 同步输入 (Sync)"
    @echo ""
    @echo ">>> Session 管理"
    @echo "Alt+w             : 打开 session-manager (浮动)"
    @echo "zellij a <name>   : attach会话"
    @echo "zellij -s <name>  : 创建会话"    
    @echo "zellij ls         : 列出会话"
    @echo "zellij k <name>   : 杀死会话(可序列化恢复)"
    @echo "zellij d <name>   : 删除 EXITED 会话记录"
    @echo ""
    @echo ">>> Scroll / 历史"
    @echo "Ctrl+s            : 进入 Scroll 模式"
    @echo "/                 : 搜索"
    @echo "e                 : 导出 scrollback 到 hx"

helix-tips:
	@echo "[全局 - 光标移动]"
	@echo "w / b / e            下个单词开头 / 上个单词开头 / 单词结尾"
	@echo "gg / G               跳转到文件开头 / 结尾"
	@echo "Ctrl-u / Ctrl-d      上翻半页 / 下翻半页"
	@echo "Ctrl-i / Ctrl-o      光标位置前进 / 后退"
	@echo "f<char>              查找下一个字符"
	@echo "t<char>              跳到目标字符前一位"
	@echo ""
	@echo "[插入模式]"
	@echo "i / a                光标前插入 / 光标后插入"
	@echo "I / A                行首插入 / 行尾插入"
	@echo "o / O                下方新开一行 / 上方新开一行"
	@echo ""
	@echo "[选择操作]"
	@echo "x                    选中当前行"
	@echo "%                    选中整个文件"
	@echo "v                    进入/退出增强选择模式"
	@echo "s                    正则筛选生成多光标"
	@echo "Alt-s                按换行分割选区为多光标"
	@echo ";                    折叠选区只保留光标"
	@echo "Alt-;                交换光标与锚点"
	@echo "C                    向下复制光标"
	@echo ""
	@echo "[编辑操作]"
	@echo "d                    删除选区"
	@echo "c                    修改选区（删除并进入插入模式）"
	@echo "y / p                复制 / 粘贴"
	@echo "r<char>              替换选中字符"
	@echo "R                    进入覆盖模式"
	@echo "u / U                撤销 / 重做"
	@echo "> / <                增加 / 减少缩进"
	@echo "~ / \` / Alt-\`       切换大小写 / 全小写 / 全大写"
	@echo ".                    重复上一次修改"
	@echo ""
	@echo "[搜索]"
	@echo "/                    搜索文本"
	@echo "n / N                下一个 / 上一个匹配"
	@echo "*                    搜索当前光标单词"
	@echo ""
	@echo "[Leader 键 (Space)]"
	@echo "Space f              打开文件选择器"
	@echo "Space b              打开 Buffer 列表"
	@echo "Space /              全局搜索"
	@echo "Space s              符号列表"
	@echo "Space r              重命名符号（LSP）"
	@echo "Space k              显示悬停信息"
	@echo "Space y / p          系统剪贴板复制 / 粘贴"
	@echo "Space w              进入窗口管理模式"
	@echo "Space ?              查看快捷键大全"
	@echo ""
	@echo "[窗口模式（Space w 进入）]"
	@echo "v / s                垂直 / 水平分割"
	@echo "h/j/k/l              切换窗口焦点"
	@echo "w                    循环切换窗口"
	@echo "q                    关闭当前窗口"
	@echo "o                    关闭其他窗口"
	@echo ""
	@echo "[匹配与包围]"
	@echo "mm                   跳转到配对括号/标签"
	@echo "ms<char>             添加包围符号"
	@echo "mr<旧><新>           替换包围符号"
	@echo "md<char>             删除包围符号"
	@echo ""
	@echo "[视图]"
	@echo "zz                   当前行居中"
	@echo "zt                   当前行置顶"
	@echo ""
	@echo "[跳转]"
	@echo "gd                   跳转到定义"
	@echo "gr                   查找引用"
	@echo "gh / gl              行首 / 行尾"
	@echo ""
	@echo "[命令行模式]"
	@echo ":w                   保存"
	@echo ":q                   退出"
	@echo ":wq                  保存并退出"
	@echo ":q!                  强制退出"
	@echo ":o <path>            打开文件"
	@echo ":config-reload       重载配置"
	@echo ":tutor               官方教程"
	@echo ":theme <name>        切换主题"