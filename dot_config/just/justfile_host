host:
    @just --list
    @just nala
    @just podman

# 系统包与镜像维护
nala:
    # @echo "正在重新测试并优化最快镜像源..."
    # sudo nala fetch --auto --https-only -y
    @echo "同步软件包索引..."
    sudo nala update
    @echo "执行系统升级..."
    sudo nala upgrade -y
    @echo "清理冗余依赖..."
    sudo nala autoremove -y
    sudo nala autopurge -y
    @echo "修复潜在依赖损坏..."
    sudo apt --fix-broken install

podman:
    @just podman-tips
    @just podman-images
    @just podman-clean

podman-tips:
    @echo "Podman 版本与运行模式:"
    podman --version
    podman info --debug | sed -n '1,120p'

    @echo "验证容器网络 (测试 curl google.com):"
    @podman run --rm alpine sh -c "apk add --no-cache curl >/dev/null && curl -I -s https://www.google.com | grep HTTP" || echo "网络连接失败或无代理"

    @echo "  查看镜像:        podman images"
    @echo "  查看容器:        podman ps -a"
    @echo "  拉取镜像:        podman pull alpine"
    @echo "  运行容器:        podman run --rm -it alpine sh"
    @echo "  停止容器:        podman stop <container>"
    @echo "  删除容器:        podman rm <container>"
    @echo "  查看日志:        podman logs <container>"
    @echo "  查看信息:        podman info"
    @echo "  Docker 兼容层:   docker ps"

podman-images:
    @echo "列出本地镜像:"
    podman images

    @echo "  拉取镜像:        podman pull <image>"
    @echo "  删除镜像:        podman rmi <image>"
    @echo "  查看容器:        podman ps -a"
    @echo "  运行容器:        podman run --rm -it <image> sh"
    @echo "  停止容器:        podman stop <container>"
    @echo "  删除容器:        podman rm <container>"
    @echo "  查看日志:        podman logs <container>"
    @echo "  查看信息:        podman info"

podman-clean:
    @echo "清理停止的容器与悬空镜像（安全）..."
    podman container prune -f
    podman image prune -f

wsl-tips:
    @echo "wsl --shutdown"
    @echo "wsl --unregister Ubuntu"
    @echo "查看可下载发行版: wsl -l -o"
    @echo "wsl --install -d Ubuntu"
    @echo "wsl --update"
    @echo "wsl --set-default-version 2"
    @echo "查看已下载发行版:wsl -l -v"