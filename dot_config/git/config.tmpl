[user]
    name = {{ .name }}
    email = {{ .email }}
    # 假设 gh 生成了标准的 ed25519 密钥；如果文件不存在，Git 会忽略此项但不报错
    signingkey = {{ .chezmoi.homeDir }}/.ssh/id_ed25519.pub
    
[gpg]
    format = ssh

[commit]
    gpgsign = true

[init]
    defaultBranch = main

# --- 核心体验优化 ---
[core]
    pager = delta
    editor = hx               # 使用 Helix 作为默认编辑器
    autocrlf = input          # 避免换行符噩梦
    ignorecase = false        # 大小写敏感
    fsmonitor = true          # 大型项目性能优化
    # 强制 Git 忽略文件遵循 XDG
    excludesfile = ~/.config/git/ignore

[interactive]
    diffFilter = delta --color-only

[delta]
    navigate = true           # 启用 n/N 键跳转 diff
    light = false             # 适配暗色终端
    side-by-side = true       # 并排显示 diff
    line-numbers = true
    # 语法高亮主题（delta 自带很多主题，推荐 syntax 或 gruvbox-dark）
    syntax-theme = Monokai Extended
    # 配色优化
    minus-style = syntax "#3f0001"
    plus-style = syntax "#003800"
    
# --- 界面显示优化 ---
[column]
    ui = auto # 分栏显示分支列表，充分利用屏幕空间

[branch]
    # 按照最后提交时间排序，最活跃的分支排在最前面
    sort = -committerdate

[tag]
    sort = version:refname

# --- 操作自动化 ---
[merge]
    conflictstyle = zdiff3    # 能够看到 共同祖先/我/他 三方代码，解决冲突的神器
    # 自动合并时如果只是简单重命名，自动处理
    renames = true

[diff]
    # 使用更智能的差异算法（对函数移动等识别更好）
    algorithm = histogram
    colorMoved = default
    mnemonicPrefix = true

[pull]
    rebase = true             # pull 时默认 rebase，保持提交线整洁
    
[push]
    autoSetupRemote = true     # 自动设置上游分支，不再需要 git push -u
    # 推送时自动推送关联的 tags
    followTags = true
    
[maintenance]
    auto = false # 建议手动管理或通过 cron 触发，避免在编译时自动触发 GC 卡顿
    strategy = incremental

[fetch]
    # 取回后自动清理远程已删除的分支（保持分支列表干净）
    prune = true
    pruneTags = true
    parallel = 0 # 并行 fetch 加速
    fsckobjects = true
    writeCommitGraph = true # 加速 git log
    
[transfer]
    fsckobjects = true # 抓取时检查数据完整性
    
[receive]
    fsckObjects = true

[rebase]
    # rebase 时自动 stash 未提交的修改，结束后自动 pop
    autoStash = true
    # 自动压缩 fixup! 提交
    autoSquash = true
    
[rerere]
    # 开启“重用记录的冲突解决方案”
    # 如果你多次在不同分支遇到同一个冲突，Git 会自动帮你解
    enabled = true
    autoupdate = true  

# --- 安全凭证 (委托给 gh) ;HTTPS 操作也不用输密码---
[credential "https://github.com"]
    helper = 
    helper = !gh auth git-credential

[credential "https://gist.github.com"]
    helper = 
    helper = !gh auth git-credential
    
# --- 性能优化 (针对超大型仓库) ---
[feature]
    # 开启许多有利于性能的默认设置（如 manyFiles, index.version=4）
    manyFiles = true
