# miseä¼šè¯»å–GITHUB_TOKENçªç ´åŒ¿åç”¨æˆ·60æ¬¡/mçš„é™åˆ¶
if mise exec gh -- gh auth status &>/dev/null; then
    export GITHUB_TOKEN=$(mise exec gh -- gh auth token)
fi

echo "ğŸ³ Configuring Container Engine..."

# Devbox Installation (Requires Nix)
if ! command -v nix &> /dev/null && [ "$IS_IMMUTABLE" -eq 0 ]; then
    echo "â„ï¸ Installing Nix (Determinate Systems)..."
    curl -L https://install.determinate.systems/nix | sh -s -- install --no-confirm

    # åˆ·æ–°ç¯å¢ƒå˜é‡ï¼ˆæ ¹æ®å®‰è£…å™¨æç¤ºï¼Œå¯èƒ½éœ€è¦é‡æ–°å¼€å¯ç»ˆç«¯æˆ– sourceï¼‰
    . /nix/var/nix/profiles/default/etc/profile.d/nix-daemon.sh
fi

if ! command -v devbox &> /dev/null; then
    echo "ğŸ“¦ Installing Devbox..."
    if [ "$IS_IMMUTABLE" -eq 1 ]; then
        # Immutable OS: å¼ºåˆ¶å®‰è£…åˆ°ç”¨æˆ·ç›®å½•ï¼Œæ— éœ€ sudo
        curl -fsSL https://get.jetify.com/devbox | FORCE=1 INSTALL_DIR="$HOME/.local/bin" bash
    else
        # Standard OS: æ ‡å‡†å®‰è£… (å¯èƒ½è§¦å‘ sudo)
        curl -fsSL https://get.jetify.com/devbox | bash
    fi
fi