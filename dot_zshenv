# --- XDG 规范 (让 Home 目录更干净) ---
export XDG_CONFIG_HOME="$HOME/.config"
export XDG_DATA_HOME="$HOME/.local/share"
export XDG_CACHE_HOME="$HOME/.cache"
export XDG_STATE_HOME="$HOME/.local/state"
# 确保核心目录存在
for dir in "$XDG_DATA_HOME" "$XDG_CACHE_HOME" "$XDG_STATE_HOME"; do
    [[ -d "$dir" ]] || mkdir -p "$dir"
done

# --- 全局变量 ---
export EDITOR='hx'
export VISUAL='hx'
export LANG=en_US.UTF-8
export PAGER='less'

# Zsh
export ZDOTDIR="$XDG_CONFIG_HOME/zsh"
export HISTFILE="$XDG_STATE_HOME/zsh/history"
export ZSH_COMPDUMP="$XDG_CACHE_HOME/zsh/zcompdump-$ZSH_VERSION"
[[ -d "$XDG_STATE_HOME/zsh" ]] || mkdir -p "$XDG_STATE_HOME/zsh"
[[ -d "$XDG_CACHE_HOME/zsh" ]] || mkdir -p "$XDG_CACHE_HOME/zsh"

# Homebrew
export HOMEBREW_CACHE="$XDG_CACHE_HOME/Homebrew"
export HOMEBREW_BUNDLE_FILE="$XDG_CONFIG_HOME/brew/Brewfile"
export HOMEBREW_NO_ANALYTICS=1
#tool
export DOCKER_CONFIG="$XDG_CONFIG_HOME/docker"
export LESSHISTFILE="$XDG_STATE_HOME/less/history"
export RIPGREP_CONFIG_PATH="$XDG_CONFIG_HOME/ripgrep/config"
export WGETRC="$XDG_CONFIG_HOME/wget/wgetrc"
export GNUPGHOME="$XDG_DATA_HOME/gnupg"
export ATUIN_CONFIG_DIR="$XDG_CONFIG_HOME/atuin"

# 编程语言(不覆盖项目配置的home路径)
[[ -z "$CARGO_HOME" ]] && export CARGO_HOME="$XDG_DATA_HOME/cargo"
[[ -z "$RUSTUP_HOME" ]] && export RUSTUP_HOME="$XDG_DATA_HOME/rustup"

if [[ -z "$GOPATH" ]]; then
    export GOPATH="$XDG_DATA_HOME/go"
    export GOMODCACHE="$XDG_CACHE_HOME/go/mod"
fi

[[ -z "$NPM_CONFIG_USERCONFIG" ]] && export NPM_CONFIG_USERCONFIG="$XDG_CONFIG_HOME/npm/npmrc"

# --- 路径增强 ---
# 将用户级 bin 加入 PATH
typeset -U PATH # 确保 PATH 不重复
path=(
  "$HOME/.local/bin" 
  "$HOMEBREW_PREFIX/bin"
  "$HOMEBREW_PREFIX/sbin"
  $path
)
export PATH

# --- Podman 伪装 Docker---
# 显式指向 Podman Socket，让原本寻找 Docker Socket 的工具找到 Podman
export DOCKER_HOST="unix://$XDG_RUNTIME_DIR/podman/podman.sock"
# 禁用 Docker 的安全检查（因为我们用的是 Podman）
export DOCKER_CONTENT_TRUST=0

# 性能优化 (跳过不必要的检查)
export SKIP_FIX_PATH=true