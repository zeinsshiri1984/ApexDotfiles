#!/usr/bin/env bash

# 1. 准备环境
tmp_file=$(mktemp /tmp/yazi-picker.XXXXXX)
trap 'rm -f "$tmp_file"' EXIT

# 强制使用 Lite 环境，极速启动
export YAZI_CONFIG_HOME="$HOME/.config/yazi/lite_env"
export YAZI_IMAGE_PREVIEW=0

# 2. 启动 Yazi
yazi "$@" --chooser-file="$tmp_file"

# 3. 处理结果
if [ -s "$tmp_file" ]; then
    selected_path=$(cat "$tmp_file")
    safe_path=$(printf "%q" "$selected_path")

    # 关闭浮动窗口 (让自己消失)
    zellij action toggle-floating-panes
    
    # 给下层的编辑器一点时间获取焦点
    sleep 0.05
    
    # 发送 Helix 命令
    # 1. ESC 确保 Normal 模式
    zellij action write 27 
    # 2. 发送 :open 命令
    zellij action write-chars ":open $safe_path"
    # 3. Enter 执行
    zellij action write 13
fi